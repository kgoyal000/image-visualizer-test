<!DOCTYPE html>
<html>
<head>
    <title>Photo Frame Viewer</title>
    <style>
        body { margin: 0; background: #f0f0f0; }
        canvas { display: block; }
        #controls {
            position: fixed;
            top: 20px;
            left: 20px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            z-index: 100;
            font-family: Arial, sans-serif;
        }
        #status {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: Arial, sans-serif;
            background: white;
            padding: 10px;
            border-radius: 4px;
            display: none;
        }
    </style>
</head>
<body>
    <div id="controls">
        <input type="file" id="imageUpload" accept="image/*">
    </div>
    <div id="status">Loading...</div>
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.159.0/three.min.js"></script>
    <script>
        window.addEventListener('load', () => {
            let scene, camera, renderer, frame;
            const status = document.getElementById('status');

            function init() {
                scene = new THREE.Scene();
                scene.background = new THREE.Color(0xf0f0f0);

                camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
                camera.position.set(0, 0, 5);

                renderer = new THREE.WebGLRenderer({ antialias: true });
                renderer.setSize(window.innerWidth, window.innerHeight);
                document.body.appendChild(renderer.domElement);

                // Enhanced lighting setup
                const ambientLight = new THREE.AmbientLight(0xffffff, 1.0);
                scene.add(ambientLight);

                const frontLight = new THREE.DirectionalLight(0xffffff, 1.0);
                frontLight.position.set(0, 0, 2);
                scene.add(frontLight);

                // Initial setup with default image
                createPhotoFrame('/api/placeholder/800/600');

                // File upload handler
                document.getElementById('imageUpload').addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const url = URL.createObjectURL(file);
                        createPhotoFrame(url);
                    }
                });

                // Simple rotation controls
                let isMouseDown = false;
                let previousMousePosition = { x: 0, y: 0 };

                renderer.domElement.addEventListener('mousedown', (e) => {
                    isMouseDown = true;
                    previousMousePosition = { x: e.clientX, y: e.clientY };
                });

                document.addEventListener('mousemove', (e) => {
                    if (!isMouseDown) return;
                    
                    const deltaMove = {
                        x: e.clientX - previousMousePosition.x,
                        y: e.clientY - previousMousePosition.y
                    };

                    if (frame) {
                        frame.rotation.y += deltaMove.x * 0.005;
                        frame.rotation.x += deltaMove.y * 0.005;
                    }

                    previousMousePosition = { x: e.clientX, y: e.clientY };
                });

                document.addEventListener('mouseup', () => isMouseDown = false);
                window.addEventListener('resize', onWindowResize);
            }

            function createPhotoFrame(imageUrl) {
                status.style.display = 'block';
                status.textContent = 'Loading image...';

                const textureLoader = new THREE.TextureLoader();
                textureLoader.load(
                    imageUrl,
                    (texture) => {
                        const width = 4;
                        const height = width / (texture.image.width / texture.image.height);
                        const depth = 0.2;
                        const frameWidth = 0.2;

                        // Remove existing frame if any
                        if (frame) scene.remove(frame);
                        
                        // Create new frame group
                        frame = new THREE.Group();

                        // Create front image plane
                        const imageGeometry = new THREE.PlaneGeometry(width, height);
                        const imageMaterial = new THREE.MeshBasicMaterial({
                            map: texture,
                            side: THREE.FrontSide
                        });
                        const imageMesh = new THREE.Mesh(imageGeometry, imageMaterial);
                        imageMesh.position.z = 0.001; // Slightly in front
                        frame.add(imageMesh);

                        // Create back panel
                        const backGeometry = new THREE.BoxGeometry(width + frameWidth * 2, height + frameWidth * 2, 0.05);
                        const backMaterial = new THREE.MeshPhongMaterial({ color: 0x333333 });
                        const backPanel = new THREE.Mesh(backGeometry, backMaterial);
                        backPanel.position.z = -0.025;
                        frame.add(backPanel);

                        // Create frame
                        const frameMaterial = new THREE.MeshPhongMaterial({ 
                            color: 0x8B4513,
                            specular: 0x222222,
                            shininess: 30
                        });

                        // Top frame
                        const topFrame = new THREE.Mesh(
                            new THREE.BoxGeometry(width + frameWidth * 2, frameWidth, depth),
                            frameMaterial
                        );
                        topFrame.position.y = height/2 + frameWidth/2;
                        frame.add(topFrame);

                        // Bottom frame
                        const bottomFrame = new THREE.Mesh(
                            new THREE.BoxGeometry(width + frameWidth * 2, frameWidth, depth),
                            frameMaterial
                        );
                        bottomFrame.position.y = -(height/2 + frameWidth/2);
                        frame.add(bottomFrame);

                        // Left frame
                        const leftFrame = new THREE.Mesh(
                            new THREE.BoxGeometry(frameWidth, height, depth),
                            frameMaterial
                        );
                        leftFrame.position.x = -(width/2 + frameWidth/2);
                        frame.add(leftFrame);

                        // Right frame
                        const rightFrame = new THREE.Mesh(
                            new THREE.BoxGeometry(frameWidth, height, depth),
                            frameMaterial
                        );
                        rightFrame.position.x = width/2 + frameWidth/2;
                        frame.add(rightFrame);

                        // Add completed frame to scene
                        scene.add(frame);
                        
                        // Set initial rotation
                        frame.rotation.y = 0.2;

                        status.style.display = 'none';
                    },
                    undefined,
                    (error) => {
                        console.error('Error loading texture:', error);
                        status.textContent = 'Error loading image';
                    }
                );
            }

            function onWindowResize() {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            }

            function animate() {
                requestAnimationFrame(animate);
                renderer.render(scene, camera);
            }

            init();
            animate();
        });
    </script>
</body>
</html>
